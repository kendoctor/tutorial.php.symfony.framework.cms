#Familiar with symfony MVC

I think you know what's the meaning of MVC which is a well-known term.

1. M - model
2. V - view
3. C - controller

All these three stuffs we will meet with in symfony framework.

In traditional php development, a page means a .php file. But, in symfony, it seems a bit different.

How can we create a page in symfony?

Because this default symfony project contains lots of files and directory. For you as a newbie, at a first glance, you will be lost.

So let us have a brief idea about symfony project structure.

##Symfony project structure

If your memory can not contain so much information below, you can skip this section. I will guide you in the project development step by step.

In the root directory of the project. there are several files.

* composer.json - it's for composer to manage dependencies.
* composer.lock - generated by composer to lock current state.
* README.md - as the name is.
* LICENSE - as the name is.

There are several folders in the root.

* app - contains configuation,console,cache,logs etc.
* web - public folder for web site contains assetics and entry php scripts.
* src - user source codes will be put into this folder
* bin - some thirty-party binary could be put into this folder
* vendor - contains thirty-party php libraires and bundles.

Let us briefly check app folder

* AppCache.php - it's for cache usage. Default is not used.
* bootstrap.php.cache - for symfony application bootstrap.
* config [folder] - as the name is, contains various configs.
* phpunit.xml.dist - have you any idea about phpunit testing?
* AppKernel.php - Kernel of app, as the name states, it's important. As app begins to run, kernel will load bundles here.
* cache [folder] - the name you can see right? needs write permission for web server.
* console - executes symfony CLI cmds.
* Resources - yeah, app level resources for symfony app.
* autoload.php - including this file to autload namespaces and classes 
* check.php - check whether your current php env are fully fit for symfony framework or not.
* logs - yes. logs something for your diagnosis. nees write permission for web server.
* SymfonyRequirements.php - You should not change it. but, you can view it.

Ok. Let us pay attension to src folder a little bit.

This folder default only contains one folder by the name Acme. 

What does it means?

It means a name for one Vendor. For example, Kendoctor, Microsoft, Sony etc.

Enter into Acme you will see DemoBundle which means a Bundle provided by vendor Acme.

Enter DemoBundle, you will see commonly used bundle structure, such as

* Controller - It's "C" here. 
* Entity - It's "M" here.
* Form - Form classes for creating forms
* Resources - "V" in this folder, aslo contains bundle-level resources here.
* Tests - Do you know?
* Others - It's not important to describe everthing here now.

Folder "Vendor" as the name is, 3-party php libraies and bundles located in this directory. You can check by yourself. Not necessary to know here.

OK. It's time to let us make our hands to move.

##Generate a bundle and create a page now

Above, we have introduced what is a bundle. Bundle is just like a java .jar package, or just like a windows .dll, which contains classes, functions, resources etc, we can reuse them from bundle.

Now, create a bundle via CLI cmd.

```
$ php app/console generate:bundle --namespace=Kendoctor/CmsBundle --format=yml
```

This cmd takes two options here

* namespace - {VendorName}/{BundleName}Bundle
* format - tells bundle generator to use yaml format configuration

If you are not familiar with yaml, take it easy, I will discuss in the process.

Issue this cmd, follow the instructions prompted. 

* Bundle name [KendoctorCmsBundle]: - Enter go on
* Target directory - Go on
* Do you want to generate the whole directory structure ? - as you like
* Format "yml" - Yes
* Confirm automatic update of your Kernel ? - yes. This will append your bundle in Kernel loading. It's necessary to let bundle work. Also you can manually do it. Check app/AppKernel.php to see what was happened.
* Confirm automatic update of the routing ? - yes. What's the routing. Just a minute.

Finally we got a KendoctorCmsBundle.

```
Kendoctor
└── CmsBundle
    ├── Controller
    │   └── DefaultController.php
    ├── DependencyInjection
    │   ├── Configuration.php
    │   └── KendoctorCmsExtension.php
    ├── KendoctorCmsBundle.php
    ├── Resources
    │   ├── config
    │   │   ├── routing.yml
    │   │   └── services.yml
    │   └── views
    │       └── Default
    │           └── index.html.twig
    └── Tests
        └── Controller
            └── DefaultControllerTest.php
```

When this bundle was generated, we already have created a new page.
How can we access ?

```
symfony-cms.com/app_dev.php/hello/world
```

The last part *world* is a parameter, you can change what you want.
*app_dev.php* is the application entry in development environment.
In development environment normally we have no cache feature, but we can get the immediate result without clearing cache when we have modifed something.

If the url matches app_dev.php/hello/{parameter}, the page will display "Hello ....".
Why? Open routing.yml in Kendoctor/CmsBundle/Resources/config.

```
kendoctor_cms_homepage:
    pattern:  /hello/{name}
    defaults: { _controller: KendoctorCmsBundle:Default:index }
```

This is a router which maps a url to a controller to run.

* pattern - the url format, here {name} means a parameter which you can get in action
* _controller - which bundle, which controller and which action will be directed to.

**NOTE**: .yml files are yaml format, indentation should use spaces, not tabs.

We can find a controller class in Kendoctor/CmsBundle/Controller folder.

```
<?php

namespace Kendoctor\CmsBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;

class DefaultController extends Controller
{
    public function indexAction($name)
    {
        return $this->render('KendoctorCmsBundle:Default:index.html.twig', array('name' => $name));
    }
}
```

Here, you should notice the name convention of _controller in router.

* KendoctorCmsBundle - bundle name
* Default - means a controller named DefaultController
* index - a method named indexAction in controller class

DefaultController derived from Symfony\Bundle\FrameworkBundle\Controller\Controller has a method *render* which return as *Response* object. This method renders a template with passed variables. Then where is the template? It's in *Resources* folder of the bundle.

* KendoctorCmsBundle - bundle name
* Default - a folder named *Default* in *Resources* folder
* index.html.twig - normally uses this name convention, {action}.{foramt}.{templating-engine}, for another example, show.xml.php

**NOTE**: here, twig is a symfony default templating engine, also you can others. But, we will use it all along, I think it's so perfect engine.

Open file index.html.twig , you will see below

```
Hello {{ name }}!
```

It's so simple. This is a twig format file. *name* is passed via the second argument of *render* method, in template you can accept it via the array assoc key.

Up to now, I think you can create your page following what you have already understood. Try it.

##Conclusion

We have explained symfony's MVC. How does symfony convert a request to a response? 

1. Url matches a router
2. The router directs the execution to a action of a controller.
3. The action does some logics ,calculations and return a response.
4. How to return a response? renders a template with variables passed in.

















